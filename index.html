<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fuel Uplift Calibrator</title>
    <style>
        :root { --blue: #0c2461; --light: #dff9fb; --green: #079992; --red: #e55039; }
        body { font-family: 'Segoe UI', sans-serif; background: #f1f2f6; padding: 20px; color: #2f3542; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        h1 { text-align: center; color: var(--blue); margin-bottom: 5px; text-transform: uppercase; }
        .subtitle { text-align: center; font-size: 0.9rem; color: #7f8c8d; margin-bottom: 25px; }

        label { font-weight: bold; font-size: 0.8rem; text-transform: uppercase; color: #57606f; display: block; margin-top: 15px; }
        
        .row { display: flex; gap: 10px; }
        input, select { width: 100%; padding: 12px; border: 2px solid #dfe4ea; border-radius: 6px; font-size: 1.1rem; font-weight: bold; text-transform: uppercase; text-align: center; }
        input:focus { border-color: var(--blue); outline: none; }

        /* The Slider Section */
        .slider-box { background: #dff9fb; padding: 15px; border-radius: 8px; margin-top: 20px; border: 1px solid #c7ecee; }
        .slider-header { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 10px; }
        input[type=range] { width: 100%; cursor: pointer; }

        button { width: 100%; padding: 15px; margin-top: 20px; background: var(--blue); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; }
        button:hover { background: #0a3d62; }

        /* Results */
        #result-box { display: none; margin-top: 25px; border-top: 2px dashed #ccc; padding-top: 20px; }
        .big-stat { text-align: center; background: var(--blue); color: white; padding: 20px; border-radius: 10px; }
        .uplift-val { font-size: 3.5rem; font-weight: 800; display: block; line-height: 1; margin-top: 5px; }
        
        .breakdown { margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .bd-item { background: #f1f2f6; padding: 10px; border-radius: 6px; text-align: center; }
        .bd-lbl { font-size: 0.75rem; color: #747d8c; text-transform: uppercase; }
        .bd-val { font-size: 1.1rem; font-weight: bold; color: var(--blue); }

    </style>
</head>
<body>

<div class="container">
    <h1>â›½ Fuel Uplift Predictor</h1>
    <p class="subtitle">Calibrated for CCU Outbound Ops</p>
    
    <div class="row">
        <div style="flex:1">
            <label>Origin</label>
            <input type="text" id="origin" value="CCU" readonly style="background:#eee; color:#888;">
        </div>
        <div style="flex:1">
            <label>Destination</label>
            <input type="text" id="destination" placeholder="DEL">
        </div>
    </div>

    <label>Aircraft Type</label>
    <select id="ac_type">
        <option value="A320">Airbus A320</option>
        <option value="B737">Boeing 737-800</option>
        <option value="B777">Boeing 777-300ER</option>
    </select>

    <div class="slider-box">
        <div class="slider-header">
            <span>Fuel On Board (Arrival)</span>
            <span id="fob-display" style="color:var(--blue)">3000 kg</span>
        </div>
        <input type="range" id="fob-slider" min="0" max="10000" step="100" value="3000" oninput="updateFOB(this.value)">
        <div style="text-align:center; font-size:0.8rem; color:#666; margin-top:5px;">Drag to match gauge indication</div>
    </div>

    <button onclick="calculate()">Calculate Uplift</button>

    <div id="result-box">
        <div class="big-stat">
            <span style="opacity:0.8; font-size:0.9rem;">REQUIRED UPLIFT</span>
            <span id="final-uplift" class="uplift-val">0 kg</span>
        </div>

        <div class="breakdown">
            <div class="bd-item">
                <div class="bd-lbl">Trip Distance</div>
                <div id="dist-val" class="bd-val">0 km</div>
            </div>
            <div class="bd-item">
                <div class="bd-lbl">Total Block Fuel</div>
                <div id="block-val" class="bd-val">0 kg</div>
            </div>
        </div>
        
        <div style="margin-top:15px; font-size:0.8rem; text-align:center; color:#999;">
            Block Fuel includes: Trip + Taxi (250) + Cont (5%) + Alt + 30min Reserve
        </div>
    </div>
</div>

<script>
    // --- CALIBRATION DATA ---
    // A320 Tuned to ~4.2 kg/km to account for heavy ATC/Climb + 2500kg fixed base
    const aircraftData = {
        "A320": { burn_rate: 4.2, base_fixed: 2600 }, 
        "B737": { burn_rate: 4.1, base_fixed: 2600 },
        "B777": { burn_rate: 9.5, base_fixed: 6000 }
    };
    
    // --- LOAD DATABASE ---
    const SHEET_URL = "airports.csv";
    let airportData = [];

    window.onload = async () => {
        try {
            const res = await fetch(SHEET_URL);
            const txt = await res.text();
            parseCSV(txt);
        } catch (e) { alert("Error loading airports.csv. Ensure it is in the repo."); }
    };

    function parseCSV(txt) {
        const rows = txt.split('\n');
        for (let i = 1; i < rows.length; i++) {
            let cols = rows[i].split(',');
            if (cols.length >= 3) {
                let code = cols[0].trim().replace(/"/g, "").toUpperCase();
                if(code) airportData.push({ code, lat: parseFloat(cols[1]), lon: parseFloat(cols[2]) });
            }
        }
    }

    // --- UI HELPERS ---
    function updateFOB(val) {
        document.getElementById('fob-display').innerText = val + " kg";
    }

    // --- CALCULATION ---
    function calculate() {
        const orgCode = document.getElementById('origin').value.toUpperCase();
        const dstCode = document.getElementById('destination').value.toUpperCase();
        const acType = document.getElementById('ac_type').value;
        const currentFOB = parseInt(document.getElementById('fob-slider').value);

        const org = airportData.find(a => a.code === orgCode);
        const dst = airportData.find(a => a.code === dstCode);

        if (!org || !dst) { alert("Airport code not found."); return; }

        // 1. Distance Calculation
        const R = 6371;
        const dLat = (dst.lat - org.lat) * Math.PI/180;
        const dLon = (dst.lon - org.lon) * Math.PI/180;
        const a = Math.sin(dLat/2)**2 + Math.cos(org.lat*Math.PI/180)*Math.cos(dst.lat*Math.PI/180) * Math.sin(dLon/2)**2;
        const dist = R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));

        // 2. Block Fuel Logic (Calibrated)
        const specs = aircraftData[acType];
        
        // Formula: (Distance * BurnRate) + Fixed Base (Taxi/Reserves)
        // This is a linear regression approximation of complex flight planning
        let blockFuel = (dist * specs.burn_rate) + specs.base_fixed;
        
        // Round to nearest 100kg
        blockFuel = Math.ceil(blockFuel / 100) * 100;

        // 3. Uplift Logic
        let uplift = blockFuel - currentFOB;
        if (uplift < 0) uplift = 0;

        // Display
        document.getElementById('result-box').style.display = "block";
        document.getElementById('final-uplift').innerText = uplift.toLocaleString() + " kg";
        document.getElementById('dist-val').innerText = Math.round(dist) + " km";
        document.getElementById('block-val').innerText = blockFuel.toLocaleString() + " kg";
    }
</script>

</body>
</html>
