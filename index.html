<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Aviation Fuel Planner</title>
    <style>
        :root { --primary: #b71c1c; --accent: #ff5722; --bg: #fdfbf7; } /* Indian Airline Theme Colors */
        body { font-family: 'Segoe UI', sans-serif; max-width: 850px; margin: 2rem auto; background: var(--bg); color: #333; }
        .container { background: white; padding: 2.5rem; border-radius: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.1); }
        
        /* Badge Styles */
        .badge-container { text-align: center; margin-bottom: 2rem; }
        .badge { background: #ffebee; color: #c62828; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; border: 1px solid #ffcdd2; margin: 0 5px; }
        
        /* Grid Layout */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }
        .full { grid-column: span 2; }
        
        label { display: block; margin-bottom: 0.5rem; font-weight: 700; color: #424242; font-size: 0.9rem; }
        input, select { width: 100%; padding: 0.9rem; border: 2px solid #eee; border-radius: 8px; font-size: 1rem; transition: border 0.3s; }
        input:focus, select:focus { border-color: var(--accent); outline: none; }
        
        button { width: 100%; background: var(--primary); color: white; padding: 1.1rem; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
        button:hover { background: #d32f2f; }

        /* Results Dashboard */
        .results { display: none; margin-top: 2rem; background: #fff; border-top: 4px solid var(--primary); }
        
        .factors-box { background: #fff3e0; padding: 1rem; border-radius: 8px; font-size: 0.85rem; color: #e65100; display: flex; justify-content: space-around; margin-bottom: 1.5rem; border: 1px solid #ffe0b2; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        .total-row { font-weight: 800; font-size: 1.2rem; background: #fafafa; color: #b71c1c; }
        
        .cost-row { display: flex; justify-content: space-between; align-items: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px dashed #ccc; }
        .cost-big { font-size: 2rem; font-weight: 800; color: #2e7d32; }
        
        .error { color: red; text-align: center; display: none; margin-bottom: 1rem; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align: center; margin-bottom: 0.5rem;">✈️ Flight Operations Calculator</h2>
    
    <div class="badge-container">
        <span class="badge">Condition: 100% Load Factor</span>
        <span class="badge">Condition: Aged Aircraft (+4% Burn)</span>
    </div>

    <div id="error-msg" class="error"></div>

    <div class="grid-2">
        <div>
            <label>Origin (IATA)</label>
            <input type="text" id="origin" placeholder="CCU" maxlength="3" style="text-transform: uppercase;">
        </div>
        <div>
            <label>Destination (IATA)</label>
            <input type="text" id="dest" placeholder="DEL" maxlength="3" style="text-transform: uppercase;">
        </div>
        <div>
            <label>Aircraft Type</label>
            <select id="ac">
                <option value="NB">A320 / B737 (Narrowbody)</option>
                <option value="WB">B777 / A350 (Widebody)</option>
            </select>
        </div>
        <div>
            <label>Route Weather</label>
            <select id="weather">
                <option value="0">Clear (Standard)</option>
                <option value="5">Moderate (Monsoon)</option>
                <option value="10">Severe (Storms)</option>
            </select>
        </div>
    </div>

    <button onclick="calculate()">Compute Fuel & Cost</button>

    <div id="res" class="results">
        
        <div class="factors-box">
            <span><strong>Perf Factor:</strong> +4% (Age)</span>
            <span><strong>Payload:</strong> High (Full Pax)</span>
            <span><strong>Airway Correction:</strong> +12%</span>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Component</th>
                    <th>Logic / Regulation</th>
                    <th>Mass (kg)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Trip Fuel</td>
                    <td>Burn + Age/Load Penalty</td>
                    <td id="val-trip"></td>
                </tr>
                <tr>
                    <td>Contingency</td>
                    <td>5% of Trip Fuel</td>
                    <td id="val-cont"></td>
                </tr>
                <tr>
                    <td>Alt + Reserve</td>
                    <td>Div to Alt + 30m Hold</td>
                    <td id="val-res"></td>
                </tr>
                <tr>
                    <td>Taxi</td>
                    <td>Operational Std</td>
                    <td id="val-taxi"></td>
                </tr>
                <tr>
                    <td>Extra</td>
                    <td>Weather Buffer</td>
                    <td id="val-extra"></td>
                </tr>
                <tr class="total-row">
                    <td>BLOCK FUEL</td>
                    <td>Ramp Total</td>
                    <td id="val-block"></td>
                </tr>
            </tbody>
        </table>

        <div class="cost-row">
            <div>
                <strong>Estimated Cost</strong><br>
                <span style="font-size: 0.9rem; color: #666;">Incl. Tax (<span id="tax-disp"></span>)</span>
            </div>
            <div class="cost-big" id="val-cost">₹ 0</div>
        </div>
    </div>
</div>

<script>
    // --- PHYSICS ENGINE CONFIGURATION ---
    
    // 1. BASELINE (Factory New, Empty)
    const BASE_AC = {
        "NB": { burn: 2300, speed: 450, taxi: 200, fixedRes: 2800 }, 
        "WB": { burn: 6500, speed: 490, taxi: 500, fixedRes: 6000 }
    };

    // 2. REALITY FACTORS (The User's Constraints)
    const FACTORS = {
        agePenalty: 1.04,     // +4% for "Moderately Old" engines
        loadPenalty: 1.15,    // +15% fuel burn for "Full Payload" vs Empty
        airwayInefficiency: 1.12 // +12% distance for Zig-Zag airways
    };

    // 3. FINANCIALS
    const FIN = {
        density: 0.80,
        price: 90,
        defTax: 4.0
    };

    let airports = {};

    window.onload = () => {
        fetch('airports.csv').then(r => r.text()).then(d => {
            d.split('\n').forEach(line => {
                const c = line.split(',');
                if(c.length >= 3) {
                    airports[c[0].trim().toUpperCase()] = { 
                        lat: parseFloat(c[1]), 
                        lon: parseFloat(c[2]), 
                        tax: c[3] ? parseFloat(c[3]) : null 
                    };
                }
            });
        });
    };

    function calculate() {
        document.getElementById('error-msg').style.display = 'none';
        
        const org = document.getElementById('origin').value.trim().toUpperCase();
        const dst = document.getElementById('dest').value.trim().toUpperCase();
        const acType = document.getElementById('ac').value;
        const wxPct = parseFloat(document.getElementById('weather').value);

        if(!airports[org] || !airports[dst]) {
            document.getElementById('error-msg').innerText = "Airport code not found.";
            document.getElementById('error-msg').style.display = 'block';
            return;
        }

        const dep = airports[org];
        const arr = airports[dst];
        const basePlane = BASE_AC[acType];

        // --- STEP 1: CALCULATE DISTANCE ---
        // Apply Airway Inefficiency (Planes don't fly straight)
        const rawDist = getDist(dep.lat, dep.lon, arr.lat, arr.lon);
        const flightDist = rawDist * FACTORS.airwayInefficiency;
        const time = flightDist / basePlane.speed;

        // --- STEP 2: CALCULATE BURN RATE ---
        // Formula: Base Burn * Age Factor * Load Factor
        // Example: 2300 * 1.04 * 1.15 = ~2750 kg/hr (This matches the calibrated real world)
        const realBurnRate = basePlane.burn * FACTORS.agePenalty * FACTORS.loadPenalty;

        // --- STEP 3: FUEL COMPONENTS ---
        const tripFuel = time * realBurnRate;
        const contFuel = tripFuel * 0.05; // 5% Mandated
        const extraFuel = tripFuel * (wxPct / 100);
        
        // Fixed Reserves (Alt + Hold) need to be adjusted for weight too? 
        // Generally Reserves are calculated at holding speed (lower burn), 
        // but we use a fixed robust block for safety.
        const reserveBlock = basePlane.fixedRes; 
        const taxiFuel = basePlane.taxi;

        const blockFuel = tripFuel + contFuel + reserveBlock + taxiFuel + extraFuel;

        // --- STEP 4: COST ---
        const taxRate = (dep.tax !== null) ? dep.tax : FIN.defTax;
        const liters = blockFuel / FIN.density;
        const totalCost = (liters * FIN.price) * (1 + taxRate/100);

        // --- RENDER ---
        document.getElementById('res').style.display = 'block';
        
        set('val-trip', fmt(tripFuel));
        set('val-cont', fmt(contFuel));
        set('val-res', fmt(reserveBlock));
        set('val-taxi', fmt(taxiFuel));
        set('val-extra', fmt(extraFuel));
        set('val-block', fmt(blockFuel) + " kg");
        
        set('tax-disp', taxRate + "%");
        set('val-cost', "₹ " + Math.round(totalCost).toLocaleString('en-IN'));
    }

    function getDist(lat1, lon1, lat2, lon2) {
        const R = 3440.065; 
        const dLat = (lat2-lat1)*Math.PI/180;
        const dLon = (lon2-lon1)*Math.PI/180;
        const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }
    function set(id, v) { document.getElementById(id).innerText = v; }
    function fmt(n) { return Math.round(n).toLocaleString(); }
</script>

</body>
</html>
