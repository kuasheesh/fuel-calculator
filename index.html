<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CCU Dispatch | Real Ops</title>
    <style>
        :root { --brand: #d63031; --dark: #2d3436; --light: #f5f6fa; --green: #00b894; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--light); color: var(--dark); padding: 20px; }
        
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-top: 5px solid var(--brand); }
        h1 { margin: 0; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 1px; }
        .sub { font-size: 0.8rem; color: #636e72; margin-bottom: 20px; }

        /* INPUTS */
        .row { display: flex; gap: 10px; margin-bottom: 15px; }
        .col { flex: 1; }
        label { font-size: 0.7rem; font-weight: 800; color: #b2bec3; text-transform: uppercase; display: block; margin-bottom: 4px; }
        input[type="text"] { width: 100%; padding: 12px; border: 2px solid #dcdde1; border-radius: 6px; font-size: 1.1rem; font-weight: 800; text-align: center; text-transform: uppercase; box-sizing: border-box; }
        input:focus { border-color: var(--brand); outline: none; background: #fff5f5; }

        /* SLIDER */
        .slider-box { background: #f1f2f6; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .slider-head { display: flex; justify-content: space-between; font-weight: 700; font-size: 0.9rem; margin-bottom: 5px; }
        input[type=range] { width: 100%; accent-color: var(--brand); }
        .slider-note { font-size: 0.7rem; color: #636e72; text-align: right; margin-top: 5px; }

        /* BUTTON */
        button { width: 100%; padding: 15px; background: var(--dark); color: white; font-weight: 700; border: none; border-radius: 6px; margin-top: 20px; cursor: pointer; font-size: 1rem; }
        button:hover { background: #000; }

        /* RESULT */
        #res { display: none; margin-top: 25px; border-top: 2px dashed #dcdde1; padding-top: 15px; }
        .big-num { font-size: 3.5rem; font-weight: 900; line-height: 1; color: var(--brand); text-align: center; }
        .lbl { text-align: center; font-size: 0.8rem; letter-spacing: 1px; font-weight: 700; color: #636e72; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .stat-box { background: #f5f6fa; padding: 10px; border-radius: 5px; text-align: center; }
        .stat-val { font-weight: 800; font-size: 1.1rem; }
        .stat-lbl { font-size: 0.65rem; text-transform: uppercase; color: #636e72; font-weight: 700; }
        
        .badge { display: inline-block; padding: 4px 8px; background: #ffeaa7; color: #d35400; font-size: 0.7rem; font-weight: 700; border-radius: 4px; margin: 10px auto; display: block; width: fit-content; }
    </style>
</head>
<body>

<div class="container">
    <h1>â›½ CCU Fuel Ops</h1>
    <p class="sub">Calibrated with IX Flight Sheets (VT-RTO/TGH/BWD)</p>

    <div class="row">
        <div class="col">
            <label>Inbound From</label>
            <input type="text" id="prev" placeholder="DEL" onkeyup="adjustSlider()">
        </div>
        <div class="col">
            <label>Destination</label>
            <input type="text" id="next" placeholder="IXZ">
        </div>
    </div>

    <div class="slider-box">
        <div class="slider-head">
            <span>Arrival Fuel (FOB)</span>
            <span id="fob-val">3000 kg</span>
        </div>
        <input type="range" id="fob" min="1500" max="8000" step="100" value="3000" oninput="document.getElementById('fob-val').innerText = this.value + ' kg'">
        <div id="slider-note" class="slider-note">Manual Adjustment</div>
    </div>

    <button onclick="calculate()">CALCULATE UPLIFT</button>

    <div id="res">
        <div class="lbl">REQUIRED UPLIFT</div>
        <div id="uplift" class="big-num">0 kg</div>
        <div id="profile-badge" class="badge">STANDARD PROFILE</div>

        <div class="stat-grid">
            <div class="stat-box">
                <div class="stat-lbl">Target Block Fuel</div>
                <div id="block" class="stat-val">0 kg</div>
            </div>
            <div class="stat-box">
                <div class="stat-lbl">Est. Trip Burn</div>
                <div id="trip" class="stat-val">0 kg</div>
            </div>
            <div class="stat-box">
                <div class="stat-lbl">Sector Type</div>
                <div id="type" class="stat-val">-</div>
            </div>
            <div class="stat-box">
                <div class="stat-lbl">Safety Stack</div>
                <div id="stack" class="stat-val">0 kg</div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- 1. DATA ---
    const SHEET_URL = "airports.csv";
    const AC_BURN = 4.1; // B737-800 Average
    const TAXI = 180;    // Updated from flight sheets (160-200 range)

    let db = [];

    window.onload = async () => {
        try {
            const res = await fetch(SHEET_URL);
            const txt = await res.text();
            let rows = txt.split('\n');
            for(let i=1; i<rows.length; i++) {
                let c = rows[i].split(',');
                if(c.length>=3) {
                    let code = c[0].trim().replace(/"/g,"").toUpperCase();
                    if(code) db.push({ code, lat: parseFloat(c[1]), lon: parseFloat(c[2]) });
                }
            }
        } catch(e) {}
    };

    // --- 2. LOGIC ---
    function adjustSlider() {
        // Simple logic: If typing short haul inbound, likely tankered in (High FOB)
        // If typing Metro inbound, likely expensive (Low FOB)
        const p = document.getElementById('prev').value.toUpperCase();
        const s = document.getElementById('fob');
        const n = document.getElementById('slider-note');
        
        if(['GAU','IXB','IXA','JAI'].includes(p)) {
            s.value = 5500;
            n.innerText = "Auto: High Arrival (Tankered)";
        } else if (['DEL','BOM','BLR','MAA'].includes(p)) {
            s.value = 2500;
            n.innerText = "Auto: Low Arrival (Metro)";
        }
        document.getElementById('fob-val').innerText = s.value + ' kg';
    }

    function calculate() {
        const next = document.getElementById('next').value.toUpperCase();
        const fob = parseInt(document.getElementById('fob').value);
        
        const org = db.find(a => a.code === "CCU"); 
        const dst = db.find(a => a.code === next);

        if(!org || !dst) { alert("Airport not found"); return; }

        // Distance & Basic Trip
        const R = 6371;
        const dLat = (dst.lat - org.lat)*Math.PI/180;
        const dLon = (dst.lon - org.lon)*Math.PI/180;
        const a = Math.sin(dLat/2)**2 + Math.cos(org.lat*Math.PI/180)*Math.cos(dst.lat*Math.PI/180) * Math.sin(dLon/2)**2;
        const dist = R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
        
        let trip = Math.round(dist * AC_BURN);
        
        // --- REAL OPS PROFILE LOGIC ---
        let targetBlock = 0;
        let type = "";
        let stack = 0;

        if (next === "IXZ") {
            // PORT BLAIR PROFILE (From Sheet: Trip 4300 -> Block 10500)
            type = "ISLAND (IXZ)";
            targetBlock = 10500; 
            stack = targetBlock - trip; 
        } 
        else if (trip < 2500) {
            // SHORT HOP PROFILE (GAU/IXB/IXA)
            // Observed: Even with 2000kg Trip, Block is never < 5500kg
            type = "SHORT HOP (TANKER)";
            targetBlock = 6000; // The 6T Floor
            if (targetBlock < (trip + 4000)) targetBlock = trip + 4000;
            stack = targetBlock - trip;
        } 
        else {
            // STANDARD METRO PROFILE (BLR/DEL)
            // Observed: Trip + ~4100kg
            type = "STANDARD METRO";
            stack = 4100;
            targetBlock = trip + stack;
        }

        let uplift = targetBlock - fob;
        if(uplift < 0) uplift = 0;

        // Display
        document.getElementById('res').style.display = "block";
        document.getElementById('uplift').innerText = uplift.toLocaleString() + " kg";
        document.getElementById('block').innerText = targetBlock.toLocaleString() + " kg";
        document.getElementById('trip').innerText = trip.toLocaleString() + " kg";
        document.getElementById('type').innerText = type;
        document.getElementById('stack').innerText = "+" + stack.toLocaleString() + " kg";
        document.getElementById('profile-badge').innerText = type + " DETECTED";
    }
</script>

</body>
</html>
